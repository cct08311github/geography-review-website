import{ah as E,h as A,j as C}from"./vendor-TecACWjj.js";import{a as D}from"./subjects-Dq9uhs1s.js";import{c as B}from"./quizzes-BRUEq-FN.js";function T(t,e){const{type:n,answer:o}=t;switch(n){case"single":return W(o,e);case"multiple":return F(o,e);case"truefalse":return L(o,e);case"matching":return N(o,e);default:return{isCorrect:!1,correctAnswer:o,userAnswer:e,score:0,error:`不支持的題型: ${n}`}}}function W(t,e){const n=t===e;return{isCorrect:n,correctAnswer:t,userAnswer:e,score:n?1:0}}function F(t,e){const n=Array.isArray(t)?t:[t],o=Array.isArray(e)?e:[],a=[...n].sort((h,d)=>h-d),f=[...o].sort((h,d)=>h-d),y=a.length===f.length&&a.every((h,d)=>h===f[d]);return{isCorrect:y,correctAnswer:a,userAnswer:f,score:y?1:0}}function L(t,e){const n=t===e;return{isCorrect:n,correctAnswer:t,userAnswer:e,score:n?1:0}}function N(t,e){const n=Array.isArray(t)?t:[],o=Array.isArray(e)?e:[];if(!o||o.length===0)return{isCorrect:!1,correctAnswer:n,userAnswer:o,score:0};let a=0;const f=new Set(n.map(m=>`${m[0]}-${m[1]}`));o.forEach(m=>{if(Array.isArray(m)&&m.length===2){const S=`${m[0]}-${m[1]}`;f.has(S)&&a++}});const y=n.length,h=a===y&&o.length===y,d=y>0?a/y:0;return{isCorrect:h,correctAnswer:n,userAnswer:o,score:d}}function R(t){const e=t.length,n=t.filter(a=>a.isCorrect).length,o=e>0?Math.round(n/e*100*100)/100:0;return{totalQuestions:e,correctAnswers:n,score:o,wrongAnswers:e-n}}function X(t){return t>=90?{grade:"A",label:"優秀",color:"green"}:t>=80?{grade:"B",label:"良好",color:"blue"}:t>=70?{grade:"C",label:"中等",color:"orange"}:t>=60?{grade:"D",label:"及格",color:"warning"}:{grade:"F",label:"需要加油",color:"red"}}function G(t){if(!t||t.length===0)return[];const e=[...t];for(let n=e.length-1;n>0;n--){const o=Math.floor(Math.random()*(n+1));[e[n],e[o]]=[e[o],e[n]]}return e}const M={generateQuestions(t,e){const n=D(t);if(!n)return[];const o=[];let a=1;return n.topics.forEach(f=>{const y=5+Math.floor(Math.random()*6);for(let h=0;h<y;h++){const d=["easy","medium","hard"][Math.floor(Math.random()*3)];o.push({id:a++,subjectId:t,topicId:f.id,type:["single","multiple","truefalse"][Math.floor(Math.random()*3)],question:this._generateQuestionText(e,f,h+1),options:this._generateOptions(e,f,h+1),answer:Math.floor(Math.random()*4),explanation:`這是第${h+1}題的解析。${f.name}是${e}學科的重要內容，請認真學習。`,difficulty:d,tags:[f.name,n.name]})}}),o},_generateQuestionText(t,e,n){const o={chinese:[`下列何者為「${e.name}」的正確用法？`,`關於「${e.name}」，下列敘述何者正確？`,`${e.description}的相關知識，以下何者正確？`,`「${e.name}」的使用時機，下列何者正確？`],english:[`Which of the following is the correct usage of "${e.name}"?`,`Regarding "${e.name}", which statement is correct?`,`Choose the best answer for "${e.name}" usage.`,`What is the proper form of "${e.name}"?`],math:[`已知條件，求${e.name}的值為何？`,`關於${e.name}，下列計算何者正確？`,`${e.description}，正確的解法為何？`,`計算${e.name}，答案為何？`],science:[`關於${e.name}的原理，下列何者正確？`,`${e.description}的相關知識，以下何者正確？`,`有關${e.name}的現象，解釋何者正確？`,`${e.name}的形成原因，下列何者正確？`],default:[`關於${e.name}，下列敘述何者正確？`,`${e.description}的相關知識，以下何者正確？`,`${e.name}為本章節重點，請問下列何者正確？`,`學習${e.name}時，應注意哪些事項？`]},a=o[t]||o.default;return a[n%a.length]},_generateOptions(t,e,n){const o={chinese:["選項A","選項B","選項C","選項D"],english:["Option A","Option B","Option C","Option D"],math:["甲","乙","丙","丁"],science:["①","②","③","④"],default:["選項一","選項二","選項三","選項四"]},a=o[t]||o.default;return[`${a[0]}：這是第一個選項的內容`,`${a[1]}：這是第二個選項的內容`,`${a[2]}：這是第三個選項的內容`,`${a[3]}：這是第四個選項的內容`]}},H=[{id:1,topicId:1,title:"台灣地形與海岸測驗",difficulty:"初級",questionsCount:25,timeLimit:1200,questions:[{id:"1-1",type:"single-choice",question:"台灣的最高峰是哪一座山？",options:["雪山","玉山","阿里山","大霸尖山"],correctAnswer:1,explanation:"玉山主峰海拔3952公尺，是台灣也是東亞最高峰。",points:4},{id:"1-2",type:"single-choice",question:"台灣最大的平原是哪一個？",options:["屏東平原","嘉南平原","宜蘭平原","台北盆地"],correctAnswer:1,explanation:"嘉南平原面積約4550平方公里，是台灣最大的平原。",points:4},{id:"1-3",type:"single-choice",question:"下列哪個海岸屬於「珊瑚礁海岸」？",options:["野柳海岸","墾丁海岸","清水斷崖","七股潟湖"],correctAnswer:1,explanation:"墾丁海岸有豐富的珊瑚礁生態，屬於珊瑚礁海岸。",points:4},{id:"1-4",type:"multiple-choice",question:"下列哪些屬於台灣的主要山脈？（複選）",options:["中央山脈","雪山山脈","八卦山山脈","海岸山脈"],correctAnswer:[0,1,3],explanation:"台灣五大山脈為：中央山脈、雪山山脈、玉山山脈、阿里山山脈、海岸山脈。",points:6},{id:"1-5",type:"true-false",question:"台灣的海岸山脈位於西部沿海地區。",correctAnswer:!1,explanation:"海岸山脈位於台灣東部，台東縱谷以東。",points:2},{id:"1-6",type:"single-choice",question:"台北盆地主要是由什麼作用形成的？",options:["火山作用","河流侵蝕","斷層陷落","風積作用"],correctAnswer:2,explanation:"台北盆地是斷層陷落後，再由河流沖積物填積而成。",points:4},{id:"1-7",type:"matching",question:"請將下列地形與其特徵配對：",leftItems:["野柳","七股潟湖","清水斷崖","墾丁"],rightItems:["珊瑚礁海岸","沉降海岸","隆起海岸","斷層海岸"],correctPairs:[[0,1],[1,2],[2,3],[3,0]],explanation:"野柳-沉降海岸、七股潟湖-隆起海岸、清水斷崖-斷層海岸、墾丁-珊瑚礁海岸。",points:8},{id:"1-8",type:"single-choice",question:"下列哪個不是台灣的盆地？",options:["台北盆地","台中盆地","埔里盆地","蘭陽盆地"],correctAnswer:3,explanation:"蘭陽地區是平原，不是盆地。正確名稱為宜蘭平原。",points:4},{id:"1-9",type:"true-false",question:"台灣的海岸線長度約為1500公里。",correctAnswer:!0,explanation:"台灣本島海岸線總長約1140公里，加上離島約1500公里。",points:2},{id:"1-10",type:"single-choice",question:"台灣哪個地區以「月世界」惡地地形聞名？",options:["高雄田寮","花蓮太魯閣","南投埔里","台東池上"],correctAnswer:0,explanation:"高雄田寮的月世界是典型的惡地地形，由泥岩組成。",points:4},{id:"1-11",type:"single-choice",question:"台灣最長的河流是哪一條？",options:["濁水溪","高屏溪","淡水河","曾文溪"],correctAnswer:0,explanation:"濁水溪全長約186公里，是台灣最長的河流。",points:4},{id:"1-12",type:"single-choice",question:"台灣哪個離島以「玄武岩柱狀節理」聞名？",options:["澎湖群島","金門","馬祖","綠島"],correctAnswer:0,explanation:"澎湖的玄武岩柱狀節理是特殊的地質景觀。",points:4},{id:"1-13",type:"multiple-choice",question:"下列哪些是台灣東部海岸的特徵？（複選）",options:["多沙灘","斷層海岸","珊瑚礁發達","海岸線平直"],correctAnswer:[1,3],explanation:"台灣東部海岸多為斷層海岸，海岸線較平直。",points:6},{id:"1-14",type:"true-false",question:"台灣的中央山脈是台灣的脊梁山脈，貫穿全島。",correctAnswer:!0,explanation:"中央山脈北起宜蘭蘇澳，南至屏東鵝鑾鼻，全長約340公里。",points:2},{id:"1-15",type:"single-choice",question:"下列哪個地區以「泥火山」地形聞名？",options:["高雄燕巢","台北陽明山","花蓮太魯閣","南投日月潭"],correctAnswer:0,explanation:"高雄燕巢的泥火山是特殊的地質景觀。",points:4},{id:"1-16",type:"single-choice",question:"台灣哪個地區有「草嶺古道」？",options:["新北市與宜蘭縣交界","台中與南投交界","高雄與屏東交界","花蓮與台東交界"],correctAnswer:0,explanation:"草嶺古道位於新北市與宜蘭縣交界，是清代重要的交通要道。",points:4},{id:"1-17",type:"multiple-choice",question:"下列哪些是台灣西部海岸的特徵？（複選）",options:["多沙灘","多潟湖","海岸線曲折","多珊瑚礁"],correctAnswer:[0,1],explanation:"台灣西部海岸多沙灘和潟湖，海岸線較平直。",points:6},{id:"1-18",type:"true-false",question:"台灣的玉山是東南亞最高峰。",correctAnswer:!1,explanation:"玉山是東亞最高峰，但不是東南亞最高峰。",points:2},{id:"1-19",type:"single-choice",question:"下列哪個不是台灣的國家公園？",options:["太魯閣國家公園","陽明山國家公園","阿里山國家公園","墾丁國家公園"],correctAnswer:2,explanation:"阿里山是國家風景區，不是國家公園。",points:4},{id:"1-20",type:"matching",question:"請將下列地形景觀與所在地區配對：",leftItems:["太魯閣峽谷","日月潭","鵝鑾鼻燈塔","野柳女王頭"],rightItems:["花蓮縣","南投縣","屏東縣","新北市"],correctPairs:[[0,0],[1,1],[2,2],[3,3]],explanation:"太魯閣-花蓮、日月潭-南投、鵝鑾鼻-屏東、野柳-新北市。",points:8},{id:"1-21",type:"single-choice",question:"台灣哪個地區以「溫泉」聞名？",options:["北投","墾丁","阿里山","日月潭"],correctAnswer:0,explanation:"台北北投是著名的溫泉區。",points:4},{id:"1-22",type:"multiple-choice",question:"下列哪些是台灣的地質公園？（複選）",options:["野柳地質公園","澎湖海洋地質公園","草嶺地質公園","太魯閣地質公園"],correctAnswer:[0,1,2],explanation:"野柳、澎湖、草嶺都是台灣的地質公園。",points:6},{id:"1-23",type:"true-false",question:"台灣的雪山是台灣第二高峰。",correctAnswer:!0,explanation:"雪山海拔3886公尺，是台灣第二高峰。",points:2},{id:"1-24",type:"single-choice",question:"下列哪個是台灣最大的湖泊？",options:["日月潭","曾文水庫","澄清湖","鯉魚潭"],correctAnswer:1,explanation:"曾文水庫是台灣最大的湖泊（水庫）。",points:4},{id:"1-25",type:"single-choice",question:"台灣哪個地區以「梯田」景觀聞名？",options:["花蓮六十石山","台東池上","宜蘭三星","新北石門"],correctAnswer:1,explanation:"台東池上的伯朗大道和梯田景觀非常有名。",points:4}]},{id:2,topicId:2,title:"氣候與水文測驗",difficulty:"中級",questionsCount:25,timeLimit:1200,questions:[{id:"2-1",type:"single-choice",question:"北回歸線通過台灣哪些縣市？",options:["嘉義、花蓮","台南、台東","屏東、宜蘭","台中、南投"],correctAnswer:0,explanation:"北回歸線通過嘉義水上、花蓮瑞穗等地。",points:4},{id:"2-2",type:"single-choice",question:"台灣哪個地區年雨量最多？",options:["基隆","台南","澎湖","台中"],correctAnswer:0,explanation:"基隆位於東北季風迎風坡，年雨量超過3000毫米。",points:4},{id:"2-3",type:"single-choice",question:"台灣最長的河流是哪一條？",options:["濁水溪","高屏溪","淡水河","曾文溪"],correctAnswer:0,explanation:"濁水溪全長約186公里，是台灣最長的河流。",points:4},{id:"2-4",type:"multiple-choice",question:"下列哪些是台灣河川的特徵？（複選）",options:["坡陡流急","長度很長","流量穩定","短小流急"],correctAnswer:[0,3],explanation:"台灣河川因地形陡峭，具有「坡陡流急、短小流急」的特徵。",points:6},{id:"2-5",type:"true-false",question:"台灣冬季主要吹西南季風。",correctAnswer:!1,explanation:"台灣冬季吹東北季風，夏季吹西南季風。",points:2},{id:"2-6",type:"single-choice",question:"下列哪個因素造成台灣山區雨量較多？",options:["對流雨","地形雨","鋒面雨","颱風雨"],correctAnswer:1,explanation:"地形抬升作用使迎風坡產生地形雨。",points:4},{id:"2-7",type:"single-choice",question:"台灣哪個季節颱風最常發生？",options:["春季","夏季","秋季","冬季"],correctAnswer:1,explanation:"7-9月是台灣颱風最頻繁的季節。",points:4},{id:"2-8",type:"single-choice",question:"「雨影區」通常出現在山脈的哪一側？",options:["迎風坡","背風坡","山頂","山腳"],correctAnswer:1,explanation:"背風坡因空氣下沉增溫，不易降雨，形成雨影區。",points:4},{id:"2-9",type:"true-false",question:"台灣的河川大多注入台灣海峽。",correctAnswer:!0,explanation:"台灣主要河川大多向西流入台灣海峽。",points:2},{id:"2-10",type:"single-choice",question:"下列哪個水庫供應大台北地區用水？",options:["曾文水庫","翡翠水庫","石門水庫","日月潭"],correctAnswer:1,explanation:"翡翠水庫是台北市的主要水源。",points:4},{id:"2-11",type:"single-choice",question:"台灣哪個地區冬季雨量最少？",options:["澎湖","基隆","宜蘭","花蓮"],correctAnswer:0,explanation:"澎湖位於台灣海峽，冬季受東北季風影響較小，雨量較少。",points:4},{id:"2-12",type:"multiple-choice",question:"下列哪些是台灣夏季的氣候特徵？（複選）",options:["高溫多雨","西南季風","颱風頻繁","東北季風"],correctAnswer:[0,1,2],explanation:"台灣夏季高溫多雨，吹西南季風，颱風頻繁。",points:6},{id:"2-13",type:"true-false",question:"台灣的河川流量季節變化不大。",correctAnswer:!1,explanation:"台灣河川流量受降雨影響，季節變化很大。",points:2},{id:"2-14",type:"single-choice",question:"下列哪個是台灣最大的水庫？",options:["曾文水庫","石門水庫","翡翠水庫","德基水庫"],correctAnswer:0,explanation:"曾文水庫是台灣最大的水庫。",points:4},{id:"2-15",type:"matching",question:"請將下列氣候類型與正確的地區配對",options:["熱帶季風氣候","亞熱帶季風氣候","溫帶季風氣候","高地氣候"],pairs:["台灣北部","台灣南部","中央山脈","恆春半島"],correctAnswer:[1,0,3,2],explanation:"台灣北部為亞熱帶季風氣候，南部為熱帶季風氣候，恆春半島為熱帶季風氣候，高山為高地氣候。",points:4}]}],j=E("question",()=>{const t=A(new Map),e=A({}),n=A(!1),o=A(null),a=C(()=>i=>{var s;return((s=e.value[i])==null?void 0:s.length)||0});async function f(i){if(e.value[i]&&e.value[i].length>0)return e.value[i];n.value=!0,o.value=null;try{let s=[];switch(i){case 1:s=M.generateQuestions(i,"chinese");break;case 2:s=M.generateQuestions(i,"english");break;case 3:s=M.generateQuestions(i,"math");break;case 4:s=M.generateQuestions(i,"science");break;case 5:s=y();break;default:s=M.generateQuestions(i,"default")}return s=s.map((c,w)=>({...c,id:c.id||+`${i}${w+1}`})),s.forEach(c=>{t.value.set(c.id,c)}),e.value[i]=s,s}catch(s){throw o.value=`加載題庫失敗: ${s.message}`,console.error(o.value),s}finally{n.value=!1}}function y(){const i=[];return B.forEach(s=>{s.questions&&Array.isArray(s.questions)&&s.questions.forEach(c=>{i.push({subjectId:5,topicId:s.topicId||1,type:c.type||"single",question:c.question,options:c.options||[],answer:c.correctAnswer!==void 0?c.correctAnswer:Array.isArray(c.correctAnswers)?c.correctAnswers[0]:0,explanation:c.explanation||"請參考相關教材",difficulty:s.difficulty||"medium",tags:s.tags||[]})})}),H.forEach(s=>{i.push({subjectId:5,topicId:s.topicId||1,type:s.type||"single",question:s.question,options:s.options||[],answer:s.correctAnswer!==void 0?s.correctAnswer:Array.isArray(s.correctAnswers)?s.correctAnswers[0]:0,explanation:s.explanation||"請參考相關教材",difficulty:s.difficulty||"medium",tags:s.tags||[]})}),i}function h(i,s=10,c=null){let w=e.value[i]||[];if(w.length===0)return console.warn(`[QuestionStore] Subject ${i} not loaded yet. returning empty array.`),[];c&&(w=w.filter($=>$.topicId===c));const v=[...w].sort(()=>Math.random()-.5);return v.slice(0,Math.min(s,v.length))}function d(i){return t.value.get(i)}function m(i,s,c=10){const v=[...(e.value[i]||[]).filter($=>$.difficulty===s)].sort(()=>Math.random()-.5);return v.slice(0,Math.min(c,v.length))}function S(i){return e.value[i]||[]}return{questionBank:t,subjectQuestions:e,isLoading:n,error:o,getSubjectQuestionCount:a,loadQuestions:f,getRandomQuestions:h,getQuestionById:d,getQuestionsByDifficulty:m,getAllSubjectQuestions:S}}),q={get(t){try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(e){return console.warn(`[PracticeStore] Failed to load ${t}:`,e),null}},set(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(n){if(n.name==="QuotaExceededError"||n.code===22)throw console.error("[PracticeStore] Storage full! Cannot save data.",n),new Error("儲存空間已滿，您的進度可能無法保存。請清理瀏覽器快取。");console.warn(`[PracticeStore] Failed to save ${t}:`,n)}},remove(t){try{localStorage.removeItem(t)}catch(e){console.warn(`[PracticeStore] Failed to remove ${t}:`,e)}}},J=()=>"session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),Y=E("practice",()=>{const t=j(),e=A(null),n=A([]),o=A(new Map),a=A(!1),f=A(null),y=C(()=>{if(!e.value)return null;const r=e.value.questions[e.value.currentQuestionIndex];return t.getQuestionById(r.id)||r}),h=C(()=>{if(!e.value)return 0;const r=e.value.questions.length,p=e.value.currentQuestionIndex;return Math.round(p/r*100)}),d=C(()=>e.value?e.value.currentQuestionIndex<e.value.questions.length-1:!1);async function m({subjectId:r,mode:p,topicId:u=null,questionCount:g=10}){a.value=!0,f.value=null;try{await t.loadQuestions(r);let l=t.getRandomQuestions(r,g,u);if(!l||l.length===0)throw new Error("題目數量不足");l=G(l);const x=l.map(Q=>({id:Q.id,subjectId:Q.subjectId}));return e.value={id:J(),subjectId:r,mode:p,topicId:u,questions:x,currentQuestionIndex:0,userAnswers:{},startTime:new Date().toISOString(),completed:!1},I(),e.value}catch(l){throw f.value=l.message,l}finally{a.value=!1}}async function S(r,p){if(!e.value)throw new Error("沒有進行中的練習會話");const u=t.getQuestionById(r);if(!u)throw new Error("題目不存在");const g=T(u,p);if(e.value.userAnswers[r]={userAnswer:p,result:g},!g.isCorrect){const l=o.value.get(r)||{count:0};o.value.set(r,{id:r,subjectId:u.subjectId,count:l.count+1,lastWrong:new Date().toISOString()}),b()}return I(),g}function i(){return d.value?(e.value.currentQuestionIndex++,I(),!0):!1}function s(){return e.value.currentQuestionIndex<=0?!1:(e.value.currentQuestionIndex--,I(),!0)}function c(r){return r<0||r>=e.value.questions.length?!1:(e.value.currentQuestionIndex=r,I(),!0)}async function w(){if(!e.value)return;const r=[],p=e.value.userAnswers;Object.keys(p).forEach(Q=>{r.push(p[Q].result)});const u=r.length,g=e.value.questions.length;for(let Q=u;Q<g;Q++)r.push({isCorrect:!1,score:0});const l=R(r),x={sessionId:e.value.id,subjectId:e.value.subjectId,mode:e.value.mode,totalQuestions:g,correctAnswers:l.correctAnswers,score:l.score,wrongAnswers:l.wrongAnswers,timeSpent:new Date-new Date(e.value.startTime),wrongQuestionIds:Array.from(o.value.keys()).slice(-l.wrongAnswers),completedAt:new Date().toISOString()};return n.value.unshift(x),O(),e.value=null,q.remove("active_session"),x}function v(r=null,p=20){const u=[];return o.value.forEach((g,l)=>{if(!r||g.subjectId===r){const x=t.getQuestionById(l);x&&u.push({...x,...g})}}),u.sort((g,l)=>l.count-g.count),u.slice(0,p)}function $(r){o.value.delete(r),b()}function _(){o.value.clear(),b()}function k(r=null,p=10){let u=n.value;return r&&(u=u.filter(g=>g.subjectId===r)),u.slice(0,p)}function I(){e.value&&q.set("active_session",e.value)}function O(){q.set("practice_history",n.value)}function b(){const r={};o.value.forEach((p,u)=>{r[u]=p}),q.set("wrong_questions",r)}function P(){const r=q.get("practice_history");r&&(n.value=r);const p=q.get("wrong_questions");p&&(o.value=new Map(Object.entries(p).map(([g,l])=>[Number(g),l])));const u=q.get("active_session");u&&(e.value=u)}return P(),{currentSession:e,sessionHistory:n,wrongQuestions:o,isLoading:a,error:f,currentQuestion:y,progress:h,hasNextQuestion:d,startPracticeSession:m,submitAnswer:S,nextQuestion:i,previousQuestion:s,goToQuestion:c,endPracticeSession:w,getWrongQuestions:v,markQuestionMastered:$,clearWrongQuestions:_,getPracticeHistory:k}});export{j as a,X as g,Y as u};
