import{H as ke,a0 as Ce,y as Ve,a6 as p,a9 as s,j as i,a7 as Ae,h as y,a5 as o,a8 as v,n,ae as h,F as C,Z as l,V as d,o as a,v as te,af as L,ag as V}from"./vendor-TecACWjj.js";import{u as Qe,a as je}from"./practice.store-Bur6BT5V.js";import{a as Ie}from"./subjects-Dq9uhs1s.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./quizzes-BRUEq-FN.js";const qe={class:"text-h6 font-weight-mono"},ze={class:"d-flex justify-space-between mb-4"},Be={class:"text-h5 font-weight-medium mb-6 lh-relaxed"},Le={class:"options-container"},Ne={class:"d-flex align-center w-100"},Oe={class:"font-weight-bold mr-3 text-body-1"},Ee={class:"text-body-1 text-high-emphasis"},Me={key:1},Ue={class:"font-weight-bold mr-3"},$e={class:"text-high-emphasis"},De={class:"d-flex flex-wrap gap-2 justify-start"},Re={class:"d-flex align-center mb-1"},Fe={class:"d-flex align-center mb-1"},Pe={class:"d-flex align-center"},He={class:"text-center mb-4"},Xe={class:"text-body-1"},Ze={key:0,class:"text-red font-weight-bold mt-2"},Ge={__name:"ExamTakingView",setup(Je){const N=Ae(),u=Qe();je();const O=y(!0),w=y(!1),f=y(0),A=y(null),_=y(null),x=y([]),ne=i(()=>u.currentSession&&u.currentSession.mode==="exam"),r=i(()=>u.currentQuestion),g=i(()=>{var t;return((t=u.currentSession)==null?void 0:t.currentQuestionIndex)||0}),S=i(()=>{var t;return((t=u.currentSession)==null?void 0:t.questions.length)||0}),se=i(()=>{var t;return(t=u.currentSession)==null?void 0:t.subjectId}),E=i(()=>Ie(se.value)),oe=i(()=>{var t;return((t=E.value)==null?void 0:t.name)||""}),le=i(()=>{var t;return((t=E.value)==null?void 0:t.color)||"primary"}),M=i(()=>r.value?r.value.type==="truefalse"?["正確","錯誤"]:r.value.options:[]),U=i(()=>u.currentSession?u.currentSession.questions.map(t=>{const e=u.currentSession.userAnswers[t.id];return e?Array.isArray(e.userAnswer)?e.userAnswer.length>0:e.userAnswer!==null&&e.userAnswer!==void 0:!1}):[]),Q=i(()=>U.value.filter(t=>t).length),$=i(()=>S.value-Q.value),D=i(()=>Math.round(Q.value/S.value*100)),ae=i(()=>{const t=Math.floor(f.value/60),e=f.value%60;return`${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`}),re=i(()=>f.value<300);ke(async()=>{if(!ne.value){alert("無效的考試會話，請重新開始。"),N.replace({name:"home"});return}O.value=!1,f.value=60*60,ve(),R()}),Ce(()=>{j()}),Ve(g,()=>{R()});const R=()=>{if(!r.value)return;const t=r.value.id,e=u.currentSession.userAnswers[t];e?r.value.type==="multiple"?x.value=e.userAnswer||[]:_.value=e.userAnswer:(_.value=null,x.value=[])},F=async()=>{if(!r.value)return;let t=_.value;r.value.type==="multiple"&&(t=x.value),await u.submitAnswer(r.value.id,t)},ue=()=>{u.nextQuestion()},ie=()=>{u.previousQuestion()},ce=t=>{u.goToQuestion(t)},de=()=>{w.value=!0},P=async()=>{w.value=!1,j();try{const t=await u.endPracticeSession();N.replace({name:"subject-practice",params:{subjectId:t.subjectId}})}catch(t){console.error("交卷失敗:",t),alert("交卷失敗，請稍後再試")}},ve=()=>{A.value=setInterval(()=>{f.value>0?f.value--:(j(),alert("考試時間到！系統將自動交卷。"),P())},1e3)},j=()=>{A.value&&clearInterval(A.value)},me=t=>({single:"單選",multiple:"多選",truefalse:"判斷"})[t]||"問答",pe=(t,e)=>t==="truefalse"?e===0?"O":"X":String.fromCharCode(65+e)+".",H=(t,e)=>t==="truefalse"?e===0:e,fe=(t,e)=>e===g.value?"primary":t?"blue-lighten-4":"grey-lighten-3",_e=t=>t===g.value?"elevated":"flat";return(t,e)=>{const X=o("v-progress-circular"),Z=o("v-row"),I=o("v-icon"),ge=o("v-app-bar-title"),T=o("v-spacer"),b=o("v-btn"),be=o("v-app-bar"),G=o("v-chip"),ye=o("v-radio"),he=o("v-radio-group"),we=o("v-checkbox"),k=o("v-card-text"),q=o("v-divider"),J=o("v-card-actions"),z=o("v-card"),K=o("v-col"),W=o("v-card-title"),B=o("v-sheet"),Y=o("v-container"),xe=o("v-main"),Se=o("v-dialog");return v(),p(Y,{fluid:"",class:"fill-height pa-0 bg-grey-lighten-4"},{default:s(()=>[O.value?(v(),p(Z,{key:0,class:"fill-height",justify:"center",align:"center"},{default:s(()=>[n(X,{indeterminate:"",size:"64",color:"primary"})]),_:1})):(v(),h(C,{key:1},[n(be,{color:"white",elevation:"1",density:"compact"},{default:s(()=>[n(ge,{class:"text-subtitle-1 font-weight-bold"},{default:s(()=>[n(I,{color:le.value,class:"mr-2"},{default:s(()=>[...e[4]||(e[4]=[l("mdi-file-document-edit",-1)])]),_:1},8,["color"]),l(" "+d(oe.value)+" - 模擬考試 ",1)]),_:1}),n(T),a("div",{class:te(["d-flex align-center mr-4",{"text-red":re.value}])},[n(I,{class:"mr-1"},{default:s(()=>[...e[5]||(e[5]=[l("mdi-timer-outline",-1)])]),_:1}),a("span",qe,d(ae.value),1)],2),n(b,{color:"primary",variant:"flat",onClick:de},{default:s(()=>[...e[6]||(e[6]=[l(" 交卷 ",-1)])]),_:1})]),_:1}),n(xe,{class:"bg-grey-lighten-4"},{default:s(()=>[n(Y,{class:"fill-height py-4"},{default:s(()=>[n(Z,{class:"fill-height"},{default:s(()=>[n(K,{cols:"12",md:"9",class:"d-flex flex-column h-100"},{default:s(()=>[n(z,{class:"flex-grow-1 d-flex flex-column rounded-lg elevation-2"},{default:s(()=>[r.value?(v(),p(k,{key:0,class:"flex-grow-1 overflow-y-auto pa-6"},{default:s(()=>[a("div",ze,[n(G,{color:"primary",label:""},{default:s(()=>[l("第 "+d(g.value+1)+" 題",1)]),_:1}),n(G,{variant:"outlined",size:"small"},{default:s(()=>[l(d(me(r.value.type)),1)]),_:1})]),a("div",Be,d(r.value.question),1),a("div",Le,[["single","truefalse"].includes(r.value.type)?(v(),p(he,{key:0,modelValue:_.value,"onUpdate:modelValue":[e[0]||(e[0]=m=>_.value=m),F]},{default:s(()=>[(v(!0),h(C,null,L(M.value,(m,c)=>(v(),p(ye,{key:c,value:H(r.value.type,c),class:te(["mb-3 pa-2 border rounded option-item",{"bg-blue-lighten-5 border-primary":_.value===H(r.value.type,c)}]),color:"primary"},{label:s(()=>[a("div",Ne,[a("span",Oe,d(pe(r.value.type,c)),1),a("span",Ee,d(m),1)])]),_:2},1032,["value","class"]))),128))]),_:1},8,["modelValue"])):V("",!0),r.value.type==="multiple"?(v(),h("div",Me,[(v(!0),h(C,null,L(M.value,(m,c)=>(v(),p(we,{key:c,modelValue:x.value,"onUpdate:modelValue":[e[1]||(e[1]=ee=>x.value=ee),F],value:c,class:"mb-2 pa-2 border rounded option-item",color:"primary","hide-details":""},{label:s(()=>[a("span",Ue,d(String.fromCharCode(65+c))+".",1),a("span",$e,d(m),1)]),_:2},1032,["modelValue","value"]))),128))])):V("",!0)])]),_:1})):V("",!0),n(q),n(J,{class:"pa-4 bg-grey-lighten-5"},{default:s(()=>[n(b,{variant:"outlined","prepend-icon":"mdi-arrow-left",disabled:g.value===0,onClick:ie},{default:s(()=>[...e[7]||(e[7]=[l(" 上一題 ",-1)])]),_:1},8,["disabled"]),n(T),n(b,{color:"primary",variant:"elevated","append-icon":"mdi-arrow-right",disabled:g.value===S.value-1,onClick:ue},{default:s(()=>[...e[8]||(e[8]=[l(" 下一題 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),n(K,{cols:"12",md:"3",class:"d-none d-md-flex flex-column h-100"},{default:s(()=>[n(z,{class:"h-100 d-flex flex-column rounded-lg"},{default:s(()=>[n(W,{class:"font-weight-bold d-flex align-center"},{default:s(()=>[n(I,{left:"",class:"mr-2"},{default:s(()=>[...e[9]||(e[9]=[l("mdi-apps",-1)])]),_:1}),e[10]||(e[10]=l(" 答題卡 ",-1))]),_:1}),n(q),n(k,{class:"overflow-y-auto"},{default:s(()=>[a("div",De,[(v(!0),h(C,null,L(U.value,(m,c)=>(v(),p(b,{key:c,color:fe(m,c),variant:_e(c),size:"small",class:"question-grid-btn",icon:"",onClick:ee=>ce(c)},{default:s(()=>[l(d(c+1),1)]),_:2},1032,["color","variant","onClick"]))),128))])]),_:1}),n(q),n(k,{class:"py-2 text-caption text-grey"},{default:s(()=>[a("div",Re,[n(B,{width:"12",height:"12",color:"primary",class:"mr-2 rounded-circle"}),e[11]||(e[11]=l(" 當前題目 ",-1))]),a("div",Fe,[n(B,{width:"12",height:"12",color:"blue-lighten-4",class:"mr-2 rounded-circle"}),e[12]||(e[12]=l(" 已作答 ",-1))]),a("div",Pe,[n(B,{width:"12",height:"12",color:"grey-lighten-3",class:"mr-2 rounded-circle border"}),e[13]||(e[13]=l(" 未作答 ",-1))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(Se,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=m=>w.value=m),"max-width":"400"},{default:s(()=>[n(z,null,{default:s(()=>[n(W,{class:"text-h5 font-weight-bold pa-4 bg-primary text-white"},{default:s(()=>[...e[14]||(e[14]=[l(" 確認交卷？ ",-1)])]),_:1}),n(k,{class:"pa-4 pt-6"},{default:s(()=>[a("div",He,[n(X,{"model-value":D.value,color:"primary",size:"80",width:"8"},{default:s(()=>[l(d(D.value)+"% ",1)]),_:1},8,["model-value"])]),a("p",Xe,[e[15]||(e[15]=l(" 您已完成 ",-1)),a("strong",null,d(Q.value),1),l(" / "+d(S.value)+" 題。 ",1)]),$.value>0?(v(),h("p",Ze," 還有 "+d($.value)+" 題未作答！ ",1)):V("",!0),e[16]||(e[16]=a("p",{class:"text-caption text-grey mt-4"}," 交卷後將無法修改答案，並立即計算成績。 ",-1))]),_:1}),n(J,{class:"pa-4"},{default:s(()=>[n(T),n(b,{variant:"text",onClick:e[2]||(e[2]=m=>w.value=!1)},{default:s(()=>[...e[17]||(e[17]=[l("再檢查一下",-1)])]),_:1}),n(b,{color:"primary",variant:"flat",onClick:P},{default:s(()=>[...e[18]||(e[18]=[l("確認交卷",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))]),_:1})}}},nt=Te(Ge,[["__scopeId","data-v-4ec59df4"]]);export{nt as default};
