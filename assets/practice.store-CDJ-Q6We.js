import{ah as E,h as v,j as b}from"./vendor-TecACWjj.js";import{a as D}from"./subjects-Dq9uhs1s.js";import{c as B}from"./quizzes-BRUEq-FN.js";function j(t,e){const{type:n,answer:o}=t;switch(n){case"single":return T(o,e);case"multiple":return G(o,e);case"truefalse":return N(o,e);case"matching":return W(o,e);default:return{isCorrect:!1,correctAnswer:o,userAnswer:e,score:0,error:`不支持的題型: ${n}`}}}function T(t,e){const n=t===e;return{isCorrect:n,correctAnswer:t,userAnswer:e,score:n?1:0}}function G(t,e){const n=Array.isArray(t)?t:[t],o=Array.isArray(e)?e:[],a=[...n].sort((d,h)=>d-h),f=[...o].sort((d,h)=>d-h),y=a.length===f.length&&a.every((d,h)=>d===f[h]);return{isCorrect:y,correctAnswer:a,userAnswer:f,score:y?1:0}}function N(t,e){const n=t===e;return{isCorrect:n,correctAnswer:t,userAnswer:e,score:n?1:0}}function W(t,e){const n=Array.isArray(t)?t:[],o=Array.isArray(e)?e:[];if(!o||o.length===0)return{isCorrect:!1,correctAnswer:n,userAnswer:o,score:0};let a=0;const f=new Set(n.map(m=>`${m[0]}-${m[1]}`));o.forEach(m=>{if(Array.isArray(m)&&m.length===2){const S=`${m[0]}-${m[1]}`;f.has(S)&&a++}});const y=n.length,d=a===y&&o.length===y,h=y>0?a/y:0;return{isCorrect:d,correctAnswer:n,userAnswer:o,score:h}}function F(t){const e=t.length,n=t.filter(a=>a.isCorrect).length,o=e>0?Math.round(n/e*100*100)/100:0;return{totalQuestions:e,correctAnswers:n,score:o,wrongAnswers:e-n}}function Z(t){return t>=90?{grade:"A",label:"優秀",color:"green"}:t>=80?{grade:"B",label:"良好",color:"blue"}:t>=70?{grade:"C",label:"中等",color:"orange"}:t>=60?{grade:"D",label:"及格",color:"warning"}:{grade:"F",label:"需要加油",color:"red"}}function H(t){if(!t||t.length===0)return[];const e=[...t];for(let n=e.length-1;n>0;n--){const o=Math.floor(Math.random()*(n+1));[e[n],e[o]]=[e[o],e[n]]}return e}const M={generateQuestions(t,e){const n=D(t);if(!n)return[];const o=[];let a=1;return n.topics.forEach(f=>{const y=5+Math.floor(Math.random()*6);for(let d=0;d<y;d++){const h=["easy","medium","hard"][Math.floor(Math.random()*3)];o.push({id:a++,subjectId:t,topicId:f.id,type:["single","multiple","truefalse"][Math.floor(Math.random()*3)],question:this._generateQuestionText(e,f,d+1),options:this._generateOptions(e,f,d+1),answer:Math.floor(Math.random()*4),explanation:`這是第${d+1}題的解析。${f.name}是${e}學科的重要內容，請認真學習。`,difficulty:h,tags:[f.name,n.name]})}}),o},_generateQuestionText(t,e,n){const o={chinese:[`下列何者為「${e.name}」的正確用法？`,`關於「${e.name}」，下列敘述何者正確？`,`${e.description}的相關知識，以下何者正確？`,`「${e.name}」的使用時機，下列何者正確？`],english:[`Which of the following is the correct usage of "${e.name}"?`,`Regarding "${e.name}", which statement is correct?`,`Choose the best answer for "${e.name}" usage.`,`What is the proper form of "${e.name}"?`],math:[`已知條件，求${e.name}的值為何？`,`關於${e.name}，下列計算何者正確？`,`${e.description}，正確的解法為何？`,`計算${e.name}，答案為何？`],science:[`關於${e.name}的原理，下列何者正確？`,`${e.description}的相關知識，以下何者正確？`,`有關${e.name}的現象，解釋何者正確？`,`${e.name}的形成原因，下列何者正確？`],default:[`關於${e.name}，下列敘述何者正確？`,`${e.description}的相關知識，以下何者正確？`,`${e.name}為本章節重點，請問下列何者正確？`,`學習${e.name}時，應注意哪些事項？`]},a=o[t]||o.default;return a[n%a.length]},_generateOptions(t,e,n){const o={chinese:["選項A","選項B","選項C","選項D"],english:["Option A","Option B","Option C","Option D"],math:["甲","乙","丙","丁"],science:["①","②","③","④"],default:["選項一","選項二","選項三","選項四"]},a=o[t]||o.default;return[`${a[0]}：這是第一個選項的內容`,`${a[1]}：這是第二個選項的內容`,`${a[2]}：這是第三個選項的內容`,`${a[3]}：這是第四個選項的內容`]}},L=[{id:1,topicId:1,title:"台灣地形與海岸測驗",difficulty:"初級",questionsCount:25,timeLimit:1200,questions:[{id:"1-1",type:"single-choice",question:"台灣的最高峰是哪一座山？",options:["雪山","玉山","阿里山","大霸尖山"],correctAnswer:1,explanation:"玉山主峰海拔3952公尺，是台灣也是東亞最高峰。",points:4},{id:"1-2",type:"single-choice",question:"台灣最大的平原是哪一個？",options:["屏東平原","嘉南平原","宜蘭平原","台北盆地"],correctAnswer:1,explanation:"嘉南平原面積約4550平方公里，是台灣最大的平原。",points:4},{id:"1-3",type:"single-choice",question:"下列哪個海岸屬於「珊瑚礁海岸」？",options:["野柳海岸","墾丁海岸","清水斷崖","七股潟湖"],correctAnswer:1,explanation:"墾丁海岸有豐富的珊瑚礁生態，屬於珊瑚礁海岸。",points:4},{id:"1-4",type:"multiple-choice",question:"下列哪些屬於台灣的主要山脈？（複選）",options:["中央山脈","雪山山脈","八卦山山脈","海岸山脈"],correctAnswer:[0,1,3],explanation:"台灣五大山脈為：中央山脈、雪山山脈、玉山山脈、阿里山山脈、海岸山脈。",points:6},{id:"1-5",type:"true-false",question:"台灣的海岸山脈位於西部沿海地區。",correctAnswer:!1,explanation:"海岸山脈位於台灣東部，台東縱谷以東。",points:2},{id:"1-6",type:"single-choice",question:"台北盆地主要是由什麼作用形成的？",options:["火山作用","河流侵蝕","斷層陷落","風積作用"],correctAnswer:2,explanation:"台北盆地是斷層陷落後，再由河流沖積物填積而成。",points:4},{id:"1-7",type:"matching",question:"請將下列地形與其特徵配對：",leftItems:["野柳","七股潟湖","清水斷崖","墾丁"],rightItems:["珊瑚礁海岸","沉降海岸","隆起海岸","斷層海岸"],correctPairs:[[0,1],[1,2],[2,3],[3,0]],explanation:"野柳-沉降海岸、七股潟湖-隆起海岸、清水斷崖-斷層海岸、墾丁-珊瑚礁海岸。",points:8},{id:"1-8",type:"single-choice",question:"下列哪個不是台灣的盆地？",options:["台北盆地","台中盆地","埔里盆地","蘭陽盆地"],correctAnswer:3,explanation:"蘭陽地區是平原，不是盆地。正確名稱為宜蘭平原。",points:4},{id:"1-9",type:"true-false",question:"台灣的海岸線長度約為1500公里。",correctAnswer:!0,explanation:"台灣本島海岸線總長約1140公里，加上離島約1500公里。",points:2},{id:"1-10",type:"single-choice",question:"台灣哪個地區以「月世界」惡地地形聞名？",options:["高雄田寮","花蓮太魯閣","南投埔里","台東池上"],correctAnswer:0,explanation:"高雄田寮的月世界是典型的惡地地形，由泥岩組成。",points:4},{id:"1-11",type:"single-choice",question:"台灣最長的河流是哪一條？",options:["濁水溪","高屏溪","淡水河","曾文溪"],correctAnswer:0,explanation:"濁水溪全長約186公里，是台灣最長的河流。",points:4},{id:"1-12",type:"single-choice",question:"台灣哪個離島以「玄武岩柱狀節理」聞名？",options:["澎湖群島","金門","馬祖","綠島"],correctAnswer:0,explanation:"澎湖的玄武岩柱狀節理是特殊的地質景觀。",points:4},{id:"1-13",type:"multiple-choice",question:"下列哪些是台灣東部海岸的特徵？（複選）",options:["多沙灘","斷層海岸","珊瑚礁發達","海岸線平直"],correctAnswer:[1,3],explanation:"台灣東部海岸多為斷層海岸，海岸線較平直。",points:6},{id:"1-14",type:"true-false",question:"台灣的中央山脈是台灣的脊梁山脈，貫穿全島。",correctAnswer:!0,explanation:"中央山脈北起宜蘭蘇澳，南至屏東鵝鑾鼻，全長約340公里。",points:2},{id:"1-15",type:"single-choice",question:"下列哪個地區以「泥火山」地形聞名？",options:["高雄燕巢","台北陽明山","花蓮太魯閣","南投日月潭"],correctAnswer:0,explanation:"高雄燕巢的泥火山是特殊的地質景觀。",points:4},{id:"1-16",type:"single-choice",question:"台灣哪個地區有「草嶺古道」？",options:["新北市與宜蘭縣交界","台中與南投交界","高雄與屏東交界","花蓮與台東交界"],correctAnswer:0,explanation:"草嶺古道位於新北市與宜蘭縣交界，是清代重要的交通要道。",points:4},{id:"1-17",type:"multiple-choice",question:"下列哪些是台灣西部海岸的特徵？（複選）",options:["多沙灘","多潟湖","海岸線曲折","多珊瑚礁"],correctAnswer:[0,1],explanation:"台灣西部海岸多沙灘和潟湖，海岸線較平直。",points:6},{id:"1-18",type:"true-false",question:"台灣的玉山是東南亞最高峰。",correctAnswer:!1,explanation:"玉山是東亞最高峰，但不是東南亞最高峰。",points:2},{id:"1-19",type:"single-choice",question:"下列哪個不是台灣的國家公園？",options:["太魯閣國家公園","陽明山國家公園","阿里山國家公園","墾丁國家公園"],correctAnswer:2,explanation:"阿里山是國家風景區，不是國家公園。",points:4},{id:"1-20",type:"matching",question:"請將下列地形景觀與所在地區配對：",leftItems:["太魯閣峽谷","日月潭","鵝鑾鼻燈塔","野柳女王頭"],rightItems:["花蓮縣","南投縣","屏東縣","新北市"],correctPairs:[[0,0],[1,1],[2,2],[3,3]],explanation:"太魯閣-花蓮、日月潭-南投、鵝鑾鼻-屏東、野柳-新北市。",points:8},{id:"1-21",type:"single-choice",question:"台灣哪個地區以「溫泉」聞名？",options:["北投","墾丁","阿里山","日月潭"],correctAnswer:0,explanation:"台北北投是著名的溫泉區。",points:4},{id:"1-22",type:"multiple-choice",question:"下列哪些是台灣的地質公園？（複選）",options:["野柳地質公園","澎湖海洋地質公園","草嶺地質公園","太魯閣地質公園"],correctAnswer:[0,1,2],explanation:"野柳、澎湖、草嶺都是台灣的地質公園。",points:6},{id:"1-23",type:"true-false",question:"台灣的雪山是台灣第二高峰。",correctAnswer:!0,explanation:"雪山海拔3886公尺，是台灣第二高峰。",points:2},{id:"1-24",type:"single-choice",question:"下列哪個是台灣最大的湖泊？",options:["日月潭","曾文水庫","澄清湖","鯉魚潭"],correctAnswer:1,explanation:"曾文水庫是台灣最大的湖泊（水庫）。",points:4},{id:"1-25",type:"single-choice",question:"台灣哪個地區以「梯田」景觀聞名？",options:["花蓮六十石山","台東池上","宜蘭三星","新北石門"],correctAnswer:1,explanation:"台東池上的伯朗大道和梯田景觀非常有名。",points:4}]},{id:2,topicId:2,title:"氣候與水文測驗",difficulty:"中級",questionsCount:25,timeLimit:1200,questions:[{id:"2-1",type:"single-choice",question:"北回歸線通過台灣哪些縣市？",options:["嘉義、花蓮","台南、台東","屏東、宜蘭","台中、南投"],correctAnswer:0,explanation:"北回歸線通過嘉義水上、花蓮瑞穗等地。",points:4},{id:"2-2",type:"single-choice",question:"台灣哪個地區年雨量最多？",options:["基隆","台南","澎湖","台中"],correctAnswer:0,explanation:"基隆位於東北季風迎風坡，年雨量超過3000毫米。",points:4},{id:"2-3",type:"single-choice",question:"台灣最長的河流是哪一條？",options:["濁水溪","高屏溪","淡水河","曾文溪"],correctAnswer:0,explanation:"濁水溪全長約186公里，是台灣最長的河流。",points:4},{id:"2-4",type:"multiple-choice",question:"下列哪些是台灣河川的特徵？（複選）",options:["坡陡流急","長度很長","流量穩定","短小流急"],correctAnswer:[0,3],explanation:"台灣河川因地形陡峭，具有「坡陡流急、短小流急」的特徵。",points:6},{id:"2-5",type:"true-false",question:"台灣冬季主要吹西南季風。",correctAnswer:!1,explanation:"台灣冬季吹東北季風，夏季吹西南季風。",points:2},{id:"2-6",type:"single-choice",question:"下列哪個因素造成台灣山區雨量較多？",options:["對流雨","地形雨","鋒面雨","颱風雨"],correctAnswer:1,explanation:"地形抬升作用使迎風坡產生地形雨。",points:4},{id:"2-7",type:"single-choice",question:"台灣哪個季節颱風最常發生？",options:["春季","夏季","秋季","冬季"],correctAnswer:1,explanation:"7-9月是台灣颱風最頻繁的季節。",points:4},{id:"2-8",type:"single-choice",question:"「雨影區」通常出現在山脈的哪一側？",options:["迎風坡","背風坡","山頂","山腳"],correctAnswer:1,explanation:"背風坡因空氣下沉增溫，不易降雨，形成雨影區。",points:4},{id:"2-9",type:"true-false",question:"台灣的河川大多注入台灣海峽。",correctAnswer:!0,explanation:"台灣主要河川大多向西流入台灣海峽。",points:2},{id:"2-10",type:"single-choice",question:"下列哪個水庫供應大台北地區用水？",options:["曾文水庫","翡翠水庫","石門水庫","日月潭"],correctAnswer:1,explanation:"翡翠水庫是台北市的主要水源。",points:4},{id:"2-11",type:"single-choice",question:"台灣哪個地區冬季雨量最少？",options:["澎湖","基隆","宜蘭","花蓮"],correctAnswer:0,explanation:"澎湖位於台灣海峽，冬季受東北季風影響較小，雨量較少。",points:4},{id:"2-12",type:"multiple-choice",question:"下列哪些是台灣夏季的氣候特徵？（複選）",options:["高溫多雨","西南季風","颱風頻繁","東北季風"],correctAnswer:[0,1,2],explanation:"台灣夏季高溫多雨，吹西南季風，颱風頻繁。",points:6},{id:"2-13",type:"true-false",question:"台灣的河川流量季節變化不大。",correctAnswer:!1,explanation:"台灣河川流量受降雨影響，季節變化很大。",points:2},{id:"2-14",type:"single-choice",question:"下列哪個是台灣最大的水庫？",options:["曾文水庫","石門水庫","翡翠水庫","德基水庫"],correctAnswer:0,explanation:"曾文水庫是台灣最大的水庫。",points:4},{id:"2-15",type:"matching",question:"請將下列氣候類型與正確的地區配對",options:["熱帶季風氣候","亞熱帶季風氣候","溫帶季風氣候","高地氣候"],pairs:["台灣北部","台灣南部","中央山脈","恆春半島"],correctAnswer:[1,0,3,2],explanation:"台灣北部為亞熱帶季風氣候，南部為熱帶季風氣候，恆春半島為熱帶季風氣候，高山為高地氣候。",points:4}]}],R=[{id:1120501,subjectId:5,topicId:1,type:"single",year:112,category:"Geography",question:"臺灣本島南北長約394公里，東西寬約144公里。若要在地圖上繪製臺灣本島，下列哪一種比例尺的地圖，所需要的圖幅最大？",options:["1：5,000","1：25,000","1：50,000","1：100,000"],answer:0,explanation:`【知識點：比例尺與圖幅大小】
比例尺越大（分母越小），地圖內容越詳細，涵蓋相同實際範圍時，所需的圖紙（圖幅）面積越大。選項中 1:5,000 是最大比例尺，故繪製全島所需的圖幅最大。`,difficulty:"medium",tags:["112會考","地理","地圖判讀"]},{id:1120502,subjectId:5,topicId:1,type:"single",year:112,category:"Geography",question:"印尼首都雅加達長期面臨地層下陷問題，印尼國會已通過法案，預計將首都遷至婆羅洲的東加里曼丹省。下列何者最可能是造成雅加達地層下陷的主要人為因素？",options:["開採石油","超抽地下水","興建高層建築","填海造陸"],answer:1,explanation:`【知識點：環境問題與災害】
雅加達人口稠密，工業與民生用水需求大，長期超抽地下水導致地層下陷，加上全球暖化海平面上升，使得水患頻繁。`,difficulty:"easy",tags:["112會考","地理","東南亞","環境議題"]},{id:1120503,subjectId:5,topicId:1,type:"single",year:112,category:"Geography",question:"某國境內多火山、地震，且擁有豐富的地熱資源。該國也是全球主要的奇異果出口國之一。依據上述特徵判斷，該國最可能位於下列哪一個板塊邊界帶上？",options:["太平洋板塊與菲律賓海板塊","太平洋板塊與印澳板塊","歐亞板塊與菲律賓海板塊","歐亞板塊與非洲板塊"],answer:1,explanation:`【知識點：板塊構造與紐西蘭地理】
題目描述的特徵（多火山地震、地熱、奇異果）指向「紐西蘭」。紐西蘭位於太平洋板塊與印澳板塊的聚合型板塊交界帶上。`,difficulty:"medium",tags:["112會考","地理","大洋洲","板塊"]},{id:1120504,subjectId:5,topicId:2,type:"single",year:112,category:"History",question:"這條鐵路在19世紀末完工通車，連結了基隆與新竹，是臺灣第一條客貨運鐵路。當時搭乘火車往來兩地，比起以前走水路或陸路便利許多。請問這條鐵路是在哪一位官員任內推動興建的？",options:["沈葆楨","丁日昌","劉銘傳","邵友濂"],answer:2,explanation:`【知識點：清領後期建設】
劉銘傳在擔任臺灣巡撫期間（1885-1891），推動多項現代化建設，包括興建鐵路。臺灣第一條鐵路（基隆至臺北段）即在其任內動工。`,difficulty:"easy",tags:["112會考","歷史","臺灣史","清領時期"]},{id:1120505,subjectId:5,topicId:2,type:"single",year:112,category:"History",question:"一本歷史書籍提到：「這個帝國橫跨歐、亞、非三洲，地中海一度成為其內海。它建立了完善的法律體系，對後世西方法律發展影響深遠。」這個帝國最可能是指下列何者？",options:["波斯帝國","亞歷山大帝國","羅馬帝國","鄂圖曼土耳其帝國"],answer:2,explanation:`【知識點：西洋上古史】
羅馬帝國全盛時期版圖橫跨歐亞非，將地中海納為內海（Mare Nostrum）。其法律體系（羅馬法）是現代西方法律的基礎。`,difficulty:"medium",tags:["112會考","歷史","世界史","羅馬帝國"]},{id:1120506,subjectId:5,topicId:3,type:"single",year:112,category:"Civics",question:"小明在網路上購買商品，收到貨後發現商品有瑕疵。依據《消費者保護法》的規定，小明在收到商品後幾日內，可以不附理由退回商品或解除契約？",options:["3日","5日","7日","10日"],answer:2,explanation:`【知識點：消費者權益】
依《消費者保護法》第19條規定，通訊交易（如網購）之消費者，得於收受商品或接受服務後7日內，以退回商品或書面通知方式解除契約，無須說明理由及負擔任何費用或對價（俗稱7天鑑賞期）。`,difficulty:"easy",tags:["112會考","公民","法律","消保法"]},{id:1120507,subjectId:5,topicId:3,type:"single",year:112,category:"Civics",question:"政府為了保障勞工權益，規定雇主必須為員工投保勞工保險。這種做法主要是為了達成下列哪一項經濟目標？",options:["促進經濟成長","維持物價穩定","充分就業","縮短貧富差距"],answer:3,question:"我國中央政府某院院長在立法院備詢時表示：「政府將持續推動綠能產業，以達成2050淨零排放目標。」依據我國憲政體制，上述「某院」最可能是下列何者？",options:["考試院","監察院","行政院","司法院"],answer:2,explanation:`【知識點：中央政府體制】
行政院為國家最高行政機關，負責制定及執行政策，並須向立法院提出施政方針及施政報告，並接受立法委員質詢。`,difficulty:"medium",tags:["112會考","公民","政治","五院"]}],J={social:[...R],science:[],math:[],english:[],chinese:[]},U=E("question",()=>{const t=v(new Map),e=v({}),n=v(!1),o=v(null),a=b(()=>r=>{var s;return((s=e.value[r])==null?void 0:s.length)||0});async function f(r){if(e.value[r]&&e.value[r].length>0)return e.value[r];n.value=!0,o.value=null;try{let s=[];switch(r){case 1:s=M.generateQuestions(r,"chinese");break;case 2:s=M.generateQuestions(r,"english");break;case 3:s=M.generateQuestions(r,"math");break;case 4:s=M.generateQuestions(r,"science");break;case 5:const c=y(),w=J.social||[];s=[...c,...w];break;default:s=M.generateQuestions(r,"default")}return s=s.map((c,w)=>({...c,id:c.id||+`${r}${w+1}`})),s.forEach(c=>{t.value.set(c.id,c)}),e.value[r]=s,s}catch(s){throw o.value=`加載題庫失敗: ${s.message}`,console.error(o.value),s}finally{n.value=!1}}function y(){const r=[];return B.forEach(s=>{s.questions&&Array.isArray(s.questions)&&s.questions.forEach(c=>{r.push({subjectId:5,topicId:s.topicId||1,type:c.type||"single",question:c.question,options:c.options||[],answer:c.correctAnswer!==void 0?c.correctAnswer:Array.isArray(c.correctAnswers)?c.correctAnswers[0]:0,explanation:c.explanation||"請參考相關教材",difficulty:s.difficulty||"medium",tags:s.tags||[]})})}),L.forEach(s=>{r.push({subjectId:5,topicId:s.topicId||1,type:s.type||"single",question:s.question,options:s.options||[],answer:s.correctAnswer!==void 0?s.correctAnswer:Array.isArray(s.correctAnswers)?s.correctAnswers[0]:0,explanation:s.explanation||"請參考相關教材",difficulty:s.difficulty||"medium",tags:s.tags||[]})}),r}function d(r,s=10,c=null){let w=e.value[r]||[];if(w.length===0)return console.warn(`[QuestionStore] Subject ${r} not loaded yet. returning empty array.`),[];c&&(w=w.filter($=>$.topicId===c));const A=[...w].sort(()=>Math.random()-.5);return A.slice(0,Math.min(s,A.length))}function h(r){return t.value.get(r)}function m(r,s,c=10){const A=[...(e.value[r]||[]).filter($=>$.difficulty===s)].sort(()=>Math.random()-.5);return A.slice(0,Math.min(c,A.length))}function S(r){return e.value[r]||[]}return{questionBank:t,subjectQuestions:e,isLoading:n,error:o,getSubjectQuestionCount:a,loadQuestions:f,getRandomQuestions:d,getQuestionById:h,getQuestionsByDifficulty:m,getAllSubjectQuestions:S}}),q={get(t){try{const e=localStorage.getItem(t);return e?JSON.parse(e):null}catch(e){return console.warn(`[PracticeStore] Failed to load ${t}:`,e),null}},set(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(n){if(n.name==="QuotaExceededError"||n.code===22)throw console.error("[PracticeStore] Storage full! Cannot save data.",n),new Error("儲存空間已滿，您的進度可能無法保存。請清理瀏覽器快取。");console.warn(`[PracticeStore] Failed to save ${t}:`,n)}},remove(t){try{localStorage.removeItem(t)}catch(e){console.warn(`[PracticeStore] Failed to remove ${t}:`,e)}}},K=()=>"session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),z=E("practice",()=>{const t=U(),e=v(null),n=v([]),o=v(new Map),a=v(!1),f=v(null),y=b(()=>{if(!e.value)return null;const i=e.value.questions[e.value.currentQuestionIndex];return t.getQuestionById(i.id)||i}),d=b(()=>{if(!e.value)return 0;const i=e.value.questions.length,p=e.value.currentQuestionIndex;return Math.round(p/i*100)}),h=b(()=>e.value?e.value.currentQuestionIndex<e.value.questions.length-1:!1);async function m({subjectId:i,mode:p,topicId:u=null,questionCount:g=10}){a.value=!0,f.value=null;try{await t.loadQuestions(i);let l=t.getRandomQuestions(i,g,u);if(!l||l.length===0)throw new Error("題目數量不足");l=H(l);const x=l.map(Q=>({id:Q.id,subjectId:Q.subjectId}));return e.value={id:K(),subjectId:i,mode:p,topicId:u,questions:x,currentQuestionIndex:0,userAnswers:{},startTime:new Date().toISOString(),completed:!1},I(),e.value}catch(l){throw f.value=l.message,l}finally{a.value=!1}}async function S(i,p){if(!e.value)throw new Error("沒有進行中的練習會話");const u=t.getQuestionById(i);if(!u)throw new Error("題目不存在");const g=j(u,p);if(e.value.userAnswers[i]={userAnswer:p,result:g},!g.isCorrect){const l=o.value.get(i)||{count:0};o.value.set(i,{id:i,subjectId:u.subjectId,count:l.count+1,lastWrong:new Date().toISOString()}),C()}return I(),g}function r(){return h.value?(e.value.currentQuestionIndex++,I(),!0):!1}function s(){return e.value.currentQuestionIndex<=0?!1:(e.value.currentQuestionIndex--,I(),!0)}function c(i){return i<0||i>=e.value.questions.length?!1:(e.value.currentQuestionIndex=i,I(),!0)}async function w(){if(!e.value)return;const i=[],p=e.value.userAnswers;Object.keys(p).forEach(Q=>{i.push(p[Q].result)});const u=i.length,g=e.value.questions.length;for(let Q=u;Q<g;Q++)i.push({isCorrect:!1,score:0});const l=F(i),x={sessionId:e.value.id,subjectId:e.value.subjectId,mode:e.value.mode,totalQuestions:g,correctAnswers:l.correctAnswers,score:l.score,wrongAnswers:l.wrongAnswers,timeSpent:new Date-new Date(e.value.startTime),wrongQuestionIds:Array.from(o.value.keys()).slice(-l.wrongAnswers),completedAt:new Date().toISOString()};return n.value.unshift(x),O(),e.value=null,q.remove("active_session"),x}function A(i=null,p=20){const u=[];return o.value.forEach((g,l)=>{if(!i||g.subjectId===i){const x=t.getQuestionById(l);x&&u.push({...x,...g})}}),u.sort((g,l)=>l.count-g.count),u.slice(0,p)}function $(i){o.value.delete(i),C()}function _(){o.value.clear(),C()}function k(i=null,p=10){let u=n.value;return i&&(u=u.filter(g=>g.subjectId===i)),u.slice(0,p)}function I(){e.value&&q.set("active_session",e.value)}function O(){q.set("practice_history",n.value)}function C(){const i={};o.value.forEach((p,u)=>{i[u]=p}),q.set("wrong_questions",i)}function P(){const i=q.get("practice_history");i&&(n.value=i);const p=q.get("wrong_questions");p&&(o.value=new Map(Object.entries(p).map(([g,l])=>[Number(g),l])));const u=q.get("active_session");u&&(e.value=u)}return P(),{currentSession:e,sessionHistory:n,wrongQuestions:o,isLoading:a,error:f,currentQuestion:y,progress:d,hasNextQuestion:h,startPracticeSession:m,submitAnswer:S,nextQuestion:r,previousQuestion:s,goToQuestion:c,endPracticeSession:w,getWrongQuestions:A,markQuestionMastered:$,clearWrongQuestions:_,getPracticeHistory:k}});export{U as a,Z as g,z as u};
